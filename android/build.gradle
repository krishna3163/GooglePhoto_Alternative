// =============================================================================
// APK Build - android/build.gradle (root project)
// Node runs from PROJECT_ROOT so node_modules is found.
// =============================================================================

def projectRoot = rootDir.parentFile

def nodePath(String requireSpec) {
  def proc = ["node", "-e", "console.log(" + requireSpec + ")"].execute(null, projectRoot)
  proc.waitFor()
  if (proc.exitValue() != 0) throw new GradleException("node failed: " + proc.err.text)
  return proc.text.trim()
}

buildscript {
  ext {
    buildToolsVersion = findProperty("android.buildToolsVersion") ?: "34.0.0"
    minSdkVersion = Integer.parseInt(findProperty("android.minSdkVersion") ?: "23")
    compileSdkVersion = Integer.parseInt(findProperty("android.compileSdkVersion") ?: "34")
    targetSdkVersion = Integer.parseInt(findProperty("android.targetSdkVersion") ?: "34")
    kotlinVersion = findProperty("android.kotlinVersion") ?: "1.9.23"
    ndkVersion = "26.1.10909125"
  }
  repositories {
    google()
    mavenCentral()
  }
  dependencies {
    classpath("com.android.tools.build:gradle:8.4.1")
    classpath("com.facebook.react:react-native-gradle-plugin")
    classpath("org.jetbrains.kotlin:kotlin-gradle-plugin")
  }
}

plugins {
  id "com.facebook.react" version "0.73.0" apply false
}

apply plugin: "com.facebook.react.rootproject"

allprojects {
  repositories {
    maven {
      url(new File(nodePath("require.resolve('react-native/package.json')"), "../android"))
    }
    maven {
      url(new File(nodePath('require.resolve("jsc-android/package.json", { paths: [require.resolve("react-native/package.json")] })'), "../dist"))
    }
    google()
    mavenCentral()
    maven { url "https://www.jitpack.io" }
  }
}
